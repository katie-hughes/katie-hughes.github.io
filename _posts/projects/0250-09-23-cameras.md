---
layout: project
permalink: /:title/
category: projects

meta:
  keywords: "unitree"

project:
  title: "Hacking Unitree Cameras"
  type: "Jekyll"
  url: "https://github.com/katie-hughes/UnitreecameraSDK/tree/main"
  logo: "/assets/images/projects/unitree/disassembled_crop.jpg"
  tech: "Unitree, strace, GDB"

---

This post (still in progress) details efforts to completely eliminate the use of the UnitreeCameraSDK to stream from the onboard cameras on the Unitree Go1 robot. The goal was to completely replace the Jetson Nanos on the robot with fresh copies that don't contain any Unitree software. 

<br>

I was able to pinpoint the exact syscall at which the cameras are enabled through their camera SDK source code using `strace` and `gdb`. It is an `ioctl` call of the following format:
```
ioctl(5, UVCIOC_CTRL_QUERY, &query)
```
*  `5` is a file descriptor referring to `/dev/video0`, the streaming device about to be unlocked
*  `query` is a struct of type `uvc_xu_control_query`, defined in `/usr/include/linux/uvcvideo.h`
*  `query.unit = 3`
*  `query.selector = 5`
*  `query.query = 1`
*  `query.size = 64`

This syscall happens after a long stream of `UVIOC_CTRL_QUERY` that sets camera parameters. These are likely to be vendor specific and it is unclear specifically which of the proceeding queries are necessary for unlocking.

I wanted to create a simple C script that would perform the appropriate syscalls to unlock the cameras without the use of the UnitreeCameraSDK, but wanted to focus on higher level aspects of the Unitree robot for my final project on crowd navigation. I currently have a simple script that relies on their camera SDK, and will unlock the cameras by instantiating a camera object and promptly segfaulting the program (more info below). After this, you can stream from the cameras using native Linux tools like `ffmpeg` or ROS packages like `usb_cam` (work in progress on these steps for ROS 2 <a href="https://github.com/katie-hughes/unitree_stream_camera" target="_blank"><u>here</u></a>). I believe that completely eliminating the UnitreeCameraSDK from the boards of the Unitree Go1 would allow for easier use of their on board cameras and promote more open source development.

## Details to replicate
My standard way of testing the cameras was through the linux `ffmpeg` command. The first thing was determining what was activating the cameras.
If you disable the autostart folder on the Jetson Nanos by renaming it something else, completely power the dog off and on again, then run the following command, you should see the following error message that indicates the cameras are locked.
```
$ ffmpeg -i /dev/video0 output0.mp4
...
could not find codec parameters for stream 0 (Video: mjpeg, none(bt470bg/unknown/unknown), 1856s800): unspecified pixel format
```
Any other attempts to read from the cameras will similarly fail with no data being encoded.

<br>


<br><br>

