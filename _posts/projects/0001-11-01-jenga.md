---
layout: project
permalink: /:title/
category: projects

meta:
  keywords: "ROS"

project:
  title: "Robot Jenga Assistant"
  type: "Jekyll"
  url: "https://github.com/ME495-EmbeddedSystems/hw3group-jengabells"
  logo: "/assets/images/projects/jenga/pulling.png"
  tech: "ROS, Computer Vision, MoveIt2"

7pieces: ST-r9X2dZMg
10pieces: ZFCv9j5TN58
---



<p>For my final project for ME495: Embedded Systems in Robotics, my group and I created a ROS2 package to turn an Franka Emika Panda 7DOF arm into a Jenga assistant.</p> 

<br>

{% include youtubePlayer.html id=page.10pieces %}

<br>
<p>Our core goal was to have the robot play alongside a human. The user would select a block and partially remove it from the tower. The robot would then detect this block, remove it the rest of the way, and place it on the top of the tower.</p>
<br>

<p>My main role on this project centered around computer vision -- given a camera image, how do we detect where the Jenga tower and the partially removed pieces are? This goal was made easier by using a camera that has a depth frame (an Intel Realsense D435i) and choosing a clever camera placement of directly above the center of the tower, looking down. 
If you look at the tower from this position using the depth frame, you will see roughly three groups of objects that exist at distinct distances from the camera. The first is the top of the tower, which is closest to the camera, has a fairly large area, and should be square-shaped at the beginning of the game. The second is the table, which is farthest from the camera and also has a very large contour area. The third is any pieces that might be partially sticking out from the side of the tower. These pieces will always exist at a distance that is somewhere between the top of the tower and the table.</p>

<br>

![Description](/assets/images/projects/jenga/scanning_cropped.gif)
<center><h2>Early work scanning to detect the top of the tower, a piece, and the table within a square region surrounding the tower. </h2></center>

<br>
<p>Upon startup, the CV node reads in the live depth frame and begins a scan downwards. First, it locates the top of the tower and the table. Once found, it continuously broadcasts the location of the top of the tower, so that the movement nodes know where to place pieces. Then it repeatedly scans between these two locations to look for pieces. When it finds an object of sufficient area in this range, it considers it a piece, and converts this into camera coordinates using the intrinsics from the Realsense. This information is also broadcasted to the tf tree, so that the movement node can set this as its goal position.</p>

<!-- <br>

![Description](/assets/images/projects/jenga/contours2.png)
<center><h2>Detecting a piece using the depth frame information. The large blue box desginates the border, anything outside of that boundary is disregarded. The green outlines are contours of large area at this particular "slice" of the depth frame. I choose the largest contour as the piece. The red point is the centroid of this largest contour, and where the arm will grab. </h2></center> -->

<br>

The vision node also computes the orientation of the top of the tower on its initial scan. For this, applies Canny edge detection and Hough lines on the portion of the color image that is aligned with the object in the depth frame. It also publishes this orientation, as it is necessary to get the right placement of the blocks on the top of the tower.

<br>

![Description](/assets/images/projects/jenga/edges.png)
<center><h2>Detecting the orientation of the tower top</h2></center>

<br>

I also briefly worked with the movement nodes. A given "turn" is defined by the starting location of the block and the ending location to place it on the top of the tower. The starting location is computed by CV. The ending locations are precomputed based on the initial height and orientation of the tower (also computed by CV), and the width of the pieces (a physical measurement), as you need to stack 3 pieces adjacent to each other. 
<br><br>

<!-- {% include youtubePlayer.html id=page.10pieces %} -->

