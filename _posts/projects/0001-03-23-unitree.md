---
layout: project
permalink: /:title/
category: projects

meta:
  keywords: "ROS"

project:
  title: "Low Level Quadruped Gait"
  type: "Jekyll"
  url: "https://github.com/katie-hughes/UnitreeGoGait"
  logo: "/assets/images/projects/unitree/walking.gif"
  tech: "ROS2, C++, Trajectory Generation"

7pieces: ST-r9X2dZMg
10pieces: pXBVbCDGRMg
---

# Generating Foot Trajectories

<br>

The trajectory that the robot's foot should follow needs to be smooth and continuous. A common method to generate such paths is Bézier curves, which have been used in similar quadruped walking gaits such as the <a href="https://dspace.mit.edu/handle/1721.1/98270" target="_blank"><u>MIT Mini Cheetah</u></a>. A Bézier curve $$B(t)$$ for $$t \in [0, 1]$$ can be generated from a set of control points $$ P_1, \dots P_n $$ via the following <a href="https://en.wikipedia.org/wiki/B%C3%A9zier_curve" target="_blank"><u>explicit definition</u></a>.

$$ B(t) = \sum_{i = 0}^n \begin{pmatrix} n \\ i \end{pmatrix} (1-t)^{n-i}t^i P_i$$

I followed the MIT Mini Cheetah implementation and generated a Bézier curve with 12 control points. These form the "swing-phase" trajectory, or the portion of the gait where the foot is off the ground. They are parameterized by the variables listed in the table below. $$\text{stand}_{x,y}$$ are the coordinates of the foot with respect to the hip joint when the robot is standing still. $$L_{span}$$ is half of the "stroke length", which is the distance traveled forward with each step. $$\Delta L$$ and $$\delta L$$ are small values that affect how quickly the velocity of the foot changes in the $$x$$ direction. $$Y_{span}$$ and $$\Delta Y$$ affect the stepping height of the foot and how quickly the $$y$$ velocity of the foot changes. More information on the details of these control points are 

<br>

| Index       | Control X coordinate | Control Y coordinate |
| ----------- | ----------- | ----------- |
| 0           | $$\text{stand}_x - L_{span}$$                             | $$\text{stand}_y$$       |
| 1           | $$\text{stand}_x - L_{span} - \Delta L$$                  | $$\text{stand}_y + Y_{span}$$       |
| 2           | $$\text{stand}_x - L_{span} - \Delta L - \delta L$$       | $$\text{stand}_y + Y_{span}$$       |
| 3           | $$\text{stand}_x - L_{span} - \Delta L - \delta L$$       | $$\text{stand}_y + Y_{span}$$       |
| 4           | $$\text{stand}_x - L_{span} - \Delta L - \delta L$$       | $$\text{stand}_y + Y_{span}$$       |
| 5           | $$\text{stand}_x$$                                        | $$\text{stand}_y + Y_{span}$$       |
| 6           | $$\text{stand}_x$$                                        | $$\text{stand}_y + Y_{span}$$       |
| 7           | $$\text{stand}_x$$                                        | $$\text{stand}_y + Y_{span} + \Delta Y$$       |
| 8           | $$\text{stand}_x + L_{span} + \Delta L + \delta L$$       | $$\text{stand}_y + Y_{span} + \Delta Y$$       |
| 9           | $$\text{stand}_x + L_{span} + \Delta L + \delta L$$       | $$\text{stand}_y + Y_{span} + \Delta Y$$       |
| 10          | $$\text{stand}_x + L_{span} + \Delta L$$                  | $$\text{stand}_y$$       |
| 11          | $$\text{stand}_x + L_{span}$$                             | $$\text{stand}_y$$       |


<br>

# Inverse Kinematics
I created a C++ library to handle the computation of inverse kinematics for the Unitree's legs. For a desired foot position in the XZ plane (i.e., no lateral hip movement), there are two solutions. In almost all scenarios, only one of these solutions is valid due to the joint limits of the leg. 

<br>

# Gait Modulation
Once I had a desired foot trajectory, the next step was to set it with various offsets onto the four different feet. A standard quadruped gait is the "trot", where the diagonal pairs of legs (front left + back right, front left + back left) move in tandem, 50% out of phase with each other.

<br>
# Low Level Control
I used positional control of the Unitree's motors to achieve the desired feet trajectories. In order to quickly reach these positions with as little error as possible, I had to apply agressive PD constants.

<br><br>

<!-- {% include youtubePlayer.html id=page.10pieces %} -->